#!/bin/bash
set -e

INSTALL_PREFIX="/home/$SUDO_USER"
TAP_DIR="$INSTALL_PREFIX/.tap"
BIN_DIR="$INSTALL_PREFIX/bin"

echo "Using install prefix=$INSTALL_PREFIX" 
echo "Creating directories:"
echo "$TAP_DIR"
echo "$BIN_DIR"

mkdir -p "$TAP_DIR"
mkdir -p "$BIN_DIR" 

echo "Creating user tap install in $TAP_DIR"

/usr/share/tap/tap package install OpenTAP --target "$TAP_DIR" | grep -v "Multiple assemblies"

# Remove symlink if it already exists
if [ -e "$BIN_DIR/tap" ]; 
then
	rm "$BIN_DIR/tap";
fi

echo "Creating tap shortcut in $BIN_DIR"
ln -s "$TAP_DIR/tap" "$BIN_DIR/tap"

chown -R $SUDO_USER:$SUDO_USER "$TAP_DIR"
chown -R $SUDO_USER:$SUDO_USER "$BIN_DIR"

echo "OpenTAP configuration completed."
echo "Please ensure that $BIN_DIR is in your PATH."
